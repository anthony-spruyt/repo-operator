# yaml-language-server: $schema=https://raw.githubusercontent.com/anthony-spruyt/xfg/main/config-schema.json
# Configuration for repo-operator - syncs files to target repositories
id: repo-operator
deleteOrphaned: true
prOptions:
  merge: auto
  mergeStrategy: squash
  deleteBranch: true

repos:
  #- git: https://github.com/anthony-spruyt/bai2csv.git

  - git: https://github.com/anthony-spruyt/claude-config.git
    files:
      .devcontainer/devcontainer.json:
        content:
          customizations:
            vscode:
              $arrayMerge: append
              extensions:
                - "jetmartin.bats"
      .eslintrc.json: false
      .hadolint.yaml: false

  - git: https://github.com/anthony-spruyt/container-images.git
    files:
      .github/workflows/trivy-scan.yaml:
        createOnly: true
      .eslintrc.json: false

  #- git: https://github.com/anthony-spruyt/esphome.git

  #- git: https://github.com/anthony-spruyt/firemerge.git

  #- git: https://github.com/anthony-spruyt/gastown-dev.git

  - git: https://github.com/anthony-spruyt/repo-operator.git
    files:
      .eslintrc.json: false
      .hadolint.yaml: false
      .pylintrc: false
    prOptions:
      merge: direct
    settings:
      rulesets:
        inherit: false

  - git: https://github.com/anthony-spruyt/spruyt-labs.git
    prOptions:
      merge: manual
    files:
      .github/renovate.json5:
        content:
          ignorePaths: ["talos/helmfile"]
    settings:
      repo:
        allowAutoMerge: false
        privateVulnerabilityReporting: false
        secretScanning: false
        secretScanningPushProtection: false
        visibility: private
      rulesets:
        inherit: false

  #- git: https://github.com/anthony-spruyt/SunGather.git

  - git: https://github.com/anthony-spruyt/xfg.git
    files:
      .devcontainer/devcontainer.json:
        content:
          features:
            "ghcr.io/devcontainers/features/azure-cli": {}
      .vscode/settings.json:
        createOnly: false
        content:
          "files.exclude":
            "dist/": true
            "node_modules/": true
            "site/": true
            "tmp/": true
          "search.exclude":
            "coverage": true
            ".output": true
      .hadolint.yaml: false
      .pylintrc: false
      trivy.yaml:
        content:
          scan:
            $arrayMerge: replace
            scanners:
              - vuln
              - secret
    settings:
      repo:
        hasDiscussions: true
      rulesets:
        pr-rules:
          bypassActors:
            - actorId: 2719952
              actorType: Integration
              bypassMode: always
        tag-rules:
          bypassActors:
            - actorId: 2719952
              actorType: Integration
              bypassMode: always

files:
  .devcontainer/devcontainer.json:
    content: "@templates/.devcontainer/devcontainer.json"
  .devcontainer/package.json:
    content: "@templates/.devcontainer/package.json"
  .devcontainer/post-create.sh:
    content: "@templates/.devcontainer/post-create.sh"
  .devcontainer/setup-devcontainer.sh:
    createOnly: true
    content: "@templates/.devcontainer/setup-devcontainer.sh"
  .github/workflows/ci.yaml:
    createOnly: true
    schemaUrl: https://raw.githubusercontent.com/SchemaStore/schemastore/master/src/schemas/json/github-workflow.json
    header: See https://github.com/anthony-spruyt/repo-operator/blob/main/src/templates/.github/workflows/ci.yaml for template comments
    content: "@templates/.github/workflows/ci.yaml"
  .github/workflows/trivy-scan.yaml:
    createOnly: true
    schemaUrl: https://raw.githubusercontent.com/SchemaStore/schemastore/master/src/schemas/json/github-workflow.json
    header: See https://github.com/anthony-spruyt/repo-operator/blob/main/src/templates/.github/workflows/trivy-scan.yaml for template comments
    content: "@templates/.github/workflows/trivy-scan.yaml"
  .github/renovate.json5:
    content: "@templates/.github/renovate.json5"
  .github/actionlint.yaml:
    createOnly: true
    header:
      - https://github.com/rhysd/actionlint/blob/main/docs/config.md
      - Ignore shellcheck warnings in all workflows
      - "SC2153: Uppercase env vars from GitHub Actions workflow env blocks"
      - "SC2034: Variables used in heredocs appear unused"
    content: "@templates/.github/actionlint.yaml"
  .vscode/settings.json:
    createOnly: true
    content: "@templates/.vscode/settings.json"
  .editorconfig:
    content: "@templates/.editorconfig"
  .gitignore:
    createOnly: true
    content: "@templates/.gitignore"
  .gitleaks.toml:
    createOnly: true
    content: "@templates/.gitleaks.toml"
  .hadolint.yaml:
    createOnly: true
    content: "@templates/.hadolint.yaml"
  .lycheeignore:
    createOnly: true
  .markdownlint.json:
    content: "@templates/.markdownlint.json"
  .markdownlintignore:
    createOnly: true
    content: "@templates/.markdownlintignore"
  .mega-linter-base.yml:
    schemaUrl: https://raw.githubusercontent.com/oxsecurity/megalinter/main/megalinter/descriptors/schemas/megalinter-configuration.jsonschema.json
    header:
      - Base MegaLinter configuration synced from repo-operator
      - This file is automatically updated - do not modify directly
      - To add custom linters, modify .mega-linter.yml instead
    content: "@templates/.mega-linter-base.yml"
  .mega-linter.yml:
    createOnly: true
    schemaUrl: https://raw.githubusercontent.com/oxsecurity/megalinter/main/megalinter/descriptors/schemas/megalinter-configuration.jsonschema.json
    header:
      - Project-specific MegaLinter configuration
      - Extends the base config from repo-operator
      - Add custom linters or overrides below
      - "Add project-specific linters below:"
      - "ENABLE_LINTERS:"
      - "  - TYPESCRIPT_ES"
      - "  - PYTHON_PYLINT"
    content: "@templates/.mega-linter.yml"
  .pre-commit-config.yaml:
    schemaUrl: https://raw.githubusercontent.com/SchemaStore/schemastore/master/src/schemas/json/pre-commit-config.json
    content: "@templates/.pre-commit-config.yaml"
  .prettierignore:
    createOnly: true
  .prettierrc.yaml:
    schemaUrl: https://raw.githubusercontent.com/SchemaStore/schemastore/master/src/schemas/json/prettierrc.json
    header: This file is automatically updated - do not modify directly
    content: "@templates/.prettierrc.yaml"
  .pylintrc:
    createOnly: true
  .shellcheckrc:
    createOnly: true
  .trivyignore.yaml:
    createOnly: true
    header:
      - Path-specific trivy ignores
      - https://trivy.dev/latest/docs/configuration/filtering
    content: "@templates/.trivyignore.yaml"
  .yamllint.yml:
    schemaUrl: https://raw.githubusercontent.com/SchemaStore/schemastore/master/src/schemas/json/yamllint.json
    header:
      - This file is automatically updated - do not modify directly
      - https://yamllint.readthedocs.io/en/latest/configuration.html
    content: "@templates/.yamllint.yml"
  .eslintrc.json:
    content: "@templates/.eslintrc.json"
  LICENSE:
    content: "@templates/LICENSE.MIT"
  lint-config.sh:
    createOnly: true
    content: "@templates/lint-config.sh"
  lint.sh:
    content: "@templates/lint.sh"
  trivy.yaml:
    schemaUrl: https://raw.githubusercontent.com/aquasecurity/trivy/main/schema/trivy-config.json
    header:
      - This file is automatically updated - do not modify directly
      - https://trivy.dev/latest/docs/references/configuration/config-file/
    content: "@templates/trivy.yaml"

settings:
  deleteOrphaned: true
  repo:
    allowAutoMerge: true
    allowForking: true
    allowMergeCommit: false
    allowRebaseMerge: false
    allowSquashMerge: true
    allowUpdateBranch: true
    archived: false
    automatedSecurityFixes: false
    defaultBranch: main
    deleteBranchOnMerge: true
    hasDiscussions: false
    hasIssues: true
    hasProjects: false
    hasWiki: false
    isTemplate: false
    mergeCommitMessage: PR_TITLE
    mergeCommitTitle: MERGE_MESSAGE
    privateVulnerabilityReporting: true
    secretScanning: true
    secretScanningPushProtection: true
    squashMergeCommitMessage: COMMIT_MESSAGES
    squashMergeCommitTitle: COMMIT_OR_PR_TITLE
    visibility: public
    vulnerabilityAlerts: false
    webCommitSignoffRequired: true
  rulesets:
    pr-rules:
      bypassActors: []
      conditions:
        refName:
          include:
            - "refs/heads/main"
          exclude: []
      enforcement: active
      rules:
        - type: code_quality
          parameters:
            severity: errors
        - type: code_scanning
          parameters:
            codeScanningTools:
              - tool: CodeQL
                alertsThreshold: errors
                securityAlertsThreshold: high_or_higher
        - type: pull_request
          parameters:
            allowedMergeMethods:
              - squash
            dismissStaleReviewsOnPush: true
            requireCodeOwnerReview: false
            requiredApprovingReviewCount: 0
            requiredReviewers: []
            requiredReviewThreadResolution: true
            requireLastPushApproval: false
        - type: required_signatures
        - type: required_status_checks
          parameters:
            doNotEnforceOnCreate: false
            requiredStatusChecks:
              - context: "summary / Check Results"
            strictRequiredStatusChecksPolicy: true
      target: branch
    push-protection:
      bypassActors: []
      conditions:
        refName:
          include:
            - "refs/heads/main"
          exclude: []
      enforcement: active
      rules:
        - type: creation
        - type: deletion
        - type: non_fast_forward
        - type: required_linear_history
      target: branch
    tag-rules:
      conditions:
        refName:
          include:
            - "refs/tags/v*"
          exclude: []
      enforcement: active
      rules:
        - type: deletion
        - type: non_fast_forward
        - type: required_signatures
      target: tag
