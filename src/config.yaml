# yaml-language-server: $schema=https://raw.githubusercontent.com/anthony-spruyt/xfg/main/config-schema.json
# Configuration for repo-operator - syncs files to target repositories
id: repo-operator

deleteOrphaned: true

prOptions:
  merge: auto
  mergeStrategy: squash
  deleteBranch: true

repos:
  #- git: https://github.com/anthony-spruyt/bai2csv.git

  - git: https://github.com/anthony-spruyt/claude-config.git
    files:
      .devcontainer/devcontainer.json:
        content:
          customizations:
            vscode:
              $arrayMerge: append
              extensions:
                - "jetmartin.bats"
      .eslintrc.json: false
      .hadolint.yaml: false

  - git: https://github.com/anthony-spruyt/container-images.git
    files:
      .github/workflows/trivy-scan.yaml:
        createOnly: true
      .eslintrc.json: false

  #- git: https://github.com/anthony-spruyt/firemerge.git

  #- git: https://github.com/anthony-spruyt/gastown-dev.git

  - git: https://github.com/anthony-spruyt/repo-operator.git
    prOptions:
      merge: direct
    files:
      .eslintrc.json: false
      .hadolint.yaml: false
      .pylintrc: false

  #- git: https://github.com/anthony-spruyt/spruyt-labs.git
  #  prOptions:
  #    merge: manual
  #  files:
  #    .github/renovate/base.json5:
  #      content:
  #        ignorePaths: ["talos/helmfile"]

  #- git: https://github.com/anthony-spruyt/SunGather.git

  - git: https://github.com/anthony-spruyt/xfg.git
    files:
      .devcontainer/devcontainer.json:
        content:
          features:
            "ghcr.io/devcontainers/features/azure-cli": {}
      .github/rulesets/pr-rules.json:
        content:
          bypass_actors:
            - actor_id: 2719952
              actor_type: "Integration"
              bypass_mode: "always"
      .vscode/settings.json:
        createOnly: false
        content:
          "files.exclude":
            "dist/": true
            "node_modules/": true
            "site/": true
            "tmp/": true
          "search.exclude":
            "coverage": true
            ".output": true
      .hadolint.yaml: false
      .pylintrc: false
      trivy.yaml:
        content:
          scan:
            $arrayMerge: replace
            scanners:
              - vuln
              - secret

files:
  .devcontainer/devcontainer.json:
    content: "@templates/.devcontainer/devcontainer.json"
  .devcontainer/package.json:
    content: "@templates/.devcontainer/package.json"
  .devcontainer/post-create.sh:
    content: "@templates/.devcontainer/post-create.sh"
  .devcontainer/setup-devcontainer.sh:
    createOnly: true
    content: "@templates/.devcontainer/setup-devcontainer.sh"
  .github/rulesets/pr-rules.json:
    content: "@templates/.github/rulesets/pr-rules.json"
  .github/rulesets/push-protection.json:
    content: "@templates/.github/rulesets/push-protection.json"
  .github/workflows/ci.yaml:
    createOnly: true
    schemaUrl: https://raw.githubusercontent.com/SchemaStore/schemastore/master/src/schemas/json/github-workflow.json
    header: See https://github.com/anthony-spruyt/repo-operator/blob/main/src/templates/.github/workflows/ci.yaml for template comments
    content: "@templates/.github/workflows/ci.yaml"
  .github/workflows/trivy-scan.yaml:
    createOnly: true
    schemaUrl: https://raw.githubusercontent.com/SchemaStore/schemastore/master/src/schemas/json/github-workflow.json
    header: See https://github.com/anthony-spruyt/repo-operator/blob/main/src/templates/.github/workflows/trivy-scan.yaml for template comments
    content: "@templates/.github/workflows/trivy-scan.yaml"
  .github/renovate.json5:
    content: "@templates/.github/renovate.json5"
  .github/apply-rulesets.sh:
    content: "@templates/.github/apply-rulesets.sh"
  .github/actionlint.yaml:
    createOnly: true
    header:
      - https://github.com/rhysd/actionlint/blob/main/docs/config.md
      - Ignore shellcheck warnings in all workflows
      - "SC2153: Uppercase env vars from GitHub Actions workflow env blocks"
      - "SC2034: Variables used in heredocs appear unused"
    content: "@templates/.github/actionlint.yaml"
  .vscode/settings.json:
    createOnly: true
    content: "@templates/.vscode/settings.json"
  .editorconfig:
    content: "@templates/.editorconfig"
  .gitignore:
    createOnly: true
    content: "@templates/.gitignore"
  .gitleaks.toml:
    createOnly: true
    content: "@templates/.gitleaks.toml"
  .hadolint.yaml:
    createOnly: true
    content: "@templates/.hadolint.yaml"
  .lycheeignore:
    createOnly: true
  .markdownlint.json:
    content: "@templates/.markdownlint.json"
  .markdownlintignore:
    createOnly: true
    content: "@templates/.markdownlintignore"
  .mega-linter-base.yml:
    schemaUrl: https://raw.githubusercontent.com/oxsecurity/megalinter/main/megalinter/descriptors/schemas/megalinter-configuration.jsonschema.json
    header:
      - Base MegaLinter configuration synced from repo-operator
      - This file is automatically updated - do not modify directly
      - To add custom linters, modify .mega-linter.yml instead
    content: "@templates/.mega-linter-base.yml"
  .mega-linter.yml:
    createOnly: true
    schemaUrl: https://raw.githubusercontent.com/oxsecurity/megalinter/main/megalinter/descriptors/schemas/megalinter-configuration.jsonschema.json
    header:
      - Project-specific MegaLinter configuration
      - Extends the base config from repo-operator
      - Add custom linters or overrides below
      - "Add project-specific linters below:"
      - "ENABLE_LINTERS:"
      - "  - TYPESCRIPT_ES"
      - "  - PYTHON_PYLINT"
    content: "@templates/.mega-linter.yml"
  .pre-commit-config.yaml:
    schemaUrl: https://raw.githubusercontent.com/SchemaStore/schemastore/master/src/schemas/json/pre-commit-config.json
    content: "@templates/.pre-commit-config.yaml"
  .prettierignore:
    createOnly: true
  .prettierrc.yaml:
    schemaUrl: https://raw.githubusercontent.com/SchemaStore/schemastore/master/src/schemas/json/prettierrc.json
    header: This file is automatically updated - do not modify directly
    content: "@templates/.prettierrc.yaml"
  .pylintrc:
    createOnly: true
  .shellcheckrc:
    createOnly: true
  .trivyignore.yaml:
    createOnly: true
    header:
      - Path-specific trivy ignores
      - https://trivy.dev/latest/docs/configuration/filtering
    content: "@templates/.trivyignore.yaml"
  .yamllint.yml:
    schemaUrl: https://raw.githubusercontent.com/SchemaStore/schemastore/master/src/schemas/json/yamllint.json
    header:
      - This file is automatically updated - do not modify directly
      - https://yamllint.readthedocs.io/en/latest/configuration.html
    content: "@templates/.yamllint.yml"
  .eslintrc.json:
    content: "@templates/.eslintrc.json"
  LICENSE:
    content: "@templates/LICENSE.MIT"
  lint-config.sh:
    createOnly: true
    content: "@templates/lint-config.sh"
  lint.sh:
    content: "@templates/lint.sh"
  trivy.yaml:
    schemaUrl: https://raw.githubusercontent.com/aquasecurity/trivy/main/schema/trivy-config.json
    header:
      - This file is automatically updated - do not modify directly
      - https://trivy.dev/latest/docs/references/configuration/config-file/
    content: "@templates/trivy.yaml"
